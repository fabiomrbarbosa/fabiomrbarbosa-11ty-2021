<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Content Manager</title>
</head>
<body>
  <!-- Include the script that builds the page and powers Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  <script>
    CMS.registerEditorComponent({
      id: "figure",
      label: "Figure",
      fields: [
        {
          name: "src",
          label: "Image src",
          widget: "string"
        },
        {
          name: "alt",
          label: "Alt Text",
          widget: "string"
        },
        {
          name: "caption",
          label: "Caption",
          widget: "string"
        },
        {
          name: "attribution",
          label: "Attribution",
          widget: "string"
        },
        {
          name: "size",
          label: "Size",
          widget: "string"
        },
      ],
      pattern: /{% Figure {\X+} %}/,
      fromBlock: function(match) {
        return {
          src: match[1],
          alt: match[2],
          caption: match[3],
          attribution: match[4],
          size: match[5],
        };
      },
      toBlock: ({ src, alt, caption, attribution, size }) =>
        `{% Figure {
          src: ${src || ''},
          alt: ${alt || ''},
          caption: ${caption || ''},
          attribution: ${ attribution || ''},
          size: ${ size || ''},
        } %}`,
      toPreview: ({ src, alt, caption, attribution, size }) => {
        return <figure><img src={src || ''} alt={alt || ''} /><figcaption>{caption || ''} | {attribution || ''}</figcaption></figure>;
      },
    });

CMS.registerEditorComponent({
  // Internal id of the component
  id: "youtube",
  // Visible label
  label: "Youtube",
  // Fields the user need to fill out when adding an instance of the component
  fields: [{name: 'id', label: 'Youtube Video ID', widget: 'string'}],
  // Pattern to identify a block as being an instance of this component
  pattern: /^youtube (\S+)$/,
  // Function to extract data elements from the regexp match
  fromBlock: function(match) {
    return {
      id: match[1]
    };
  },
  // Function to create a text block from an instance of this component
  toBlock: function(obj) {
    return 'youtube ' + obj.id;
  },
  // Preview output for this component. Can either be a string or a React component
  // (component gives better render performance)
  toPreview: function(obj) {
    return (
      '<img src="http://img.youtube.com/vi/' + obj.id + '/maxresdefault.jpg" alt="Youtube Video"/>'
    );
  }
});

  </script>
</body>
</html>
